{"version":3,"file":"hwc.cjs.development.js","sources":["../src/contexts/HwcContext.tsx","../src/constants.ts","../src/utils/posToDate.ts","../src/utils/round.ts","../src/hooks/useHwc.ts","../src/components/HwcDragPane.tsx","../src/components/HwcGrid.tsx","../src/utils/events.ts","../src/components/HwcEventsRenderer.tsx","../src/components/HwcHeader.tsx"],"sourcesContent":["import React from 'react';\nimport { HwcEvent } from '../models/event.model';\nimport { Pos } from '../models/pos.model';\n\nexport type IHwcContext = {\n  pos: Pos;\n  date: Date;\n  startDay: Date;\n  daysCount: number;\n  cellHeight: number;\n  cellWidth: number;\n\n  events: HwcEvent[];\n\n  setPos: (pos: Pos) => void;\n  setWidth: (width: number) => void;\n\n  shadowEvent?: HwcEvent;\n  setStartDragDate: (date?: Date) => void;\n  requestAddEventHandler: (ev: HwcEvent) => void;\n};\n\nexport const HwcContext = React.createContext<IHwcContext | null>(null);\n\nexport const HwcProvider = HwcContext.Provider;\n\nexport const useHwcContext = () => {\n  const ctx = React.useContext(HwcContext);\n  if (ctx === null)\n    throw new Error(\n      'No WeekPicker Context found. Please Wrap Hwc components in <HwcProvider />'\n    );\n\n  return ctx;\n};\n","export const MINUTE_IN_MILLIS = 60 * 1000;\nexport const HOUR_IN_MILLIS = 60 * MINUTE_IN_MILLIS;\nexport const DAY_IN_MILLIS = 24 * HOUR_IN_MILLIS;\n","import { DAY_IN_MILLIS, MINUTE_IN_MILLIS } from '../constants';\nimport { Pos } from '../models/pos.model';\n\nexport const posToDate = (\n  pos: Pos,\n  width: number,\n  startDay: Date,\n  hourHeight: number\n): Date => {\n  const minuteHeight = 60 / hourHeight;\n  const minutesDay = pos.y * minuteHeight;\n\n  const dayInGrid = Math.trunc((pos.x / (width || 1)) * 7);\n\n  return new Date(\n    startDay.getTime() +\n      dayInGrid * DAY_IN_MILLIS +\n      minutesDay * MINUTE_IN_MILLIS\n  );\n};\n","export const roundToQuarterHour = (date: Date): Date => {\n  const rounded = startOfMinute(date);\n  const minutes = rounded.getMinutes() + rounded.getHours() * 60;\n\n  const roundedMinute = (Math.round((minutes / 60) * 4) * 60) / 4;\n\n  const d = startOfDay(date);\n  d.setMinutes(roundedMinute);\n  return d;\n};\n\nexport const roundToSemiHour = (date: Date): Date => {\n  const rounded = startOfMinute(date);\n  const minutes = rounded.getMinutes() + rounded.getHours() * 60;\n\n  const roundedMinute = (Math.round((minutes / 60) * 2) * 60) / 2;\n\n  const d = startOfDay(date);\n  d.setMinutes(roundedMinute);\n  return d;\n};\n\nexport const roundToHour = (date: Date): Date => {\n  return startOfHour(date);\n};\n\nexport const startOfDay = (input: string | number | Date): Date => {\n  const d = new Date(input);\n  d.setHours(0, 0, 0, 0);\n\n  return d;\n};\n\nexport const startOfHour = (input: string | number | Date): Date => {\n  const d = new Date(input);\n  d.setMinutes(0, 0, 0);\n\n  return d;\n};\n\nexport const startOfMinute = (input: string | number | Date): Date => {\n  const d = new Date(input);\n  d.setSeconds(0, 0);\n\n  return d;\n};\n","import { useCallback, useMemo, useState } from 'react';\nimport { IHwcContext } from '../contexts/HwcContext';\nimport { HwcEvent } from '../models/event.model';\nimport { Pos } from '../models/pos.model';\nimport { posToDate } from '../utils/posToDate';\nimport { roundToQuarterHour, startOfDay } from '../utils/round';\n\nexport type UseHwcProps = {\n  startDay?: Date;\n  daysCount?: number;\n  cellHeight?: number;\n\n  events?: HwcEvent[];\n\n  onAddEventRequest?: (ev: HwcEvent) => void;\n};\n\nexport const useHwc = (props: UseHwcProps = {}): IHwcContext => {\n  const {\n    startDay = new Date(),\n    cellHeight = 50,\n    daysCount = 7,\n    events = [],\n    onAddEventRequest = () => {},\n  } = props;\n\n  const normalizedStartDay = useMemo(() => startOfDay(startDay), [startDay]);\n\n  // column witdh\n  const [width, setWidth] = useState(0);\n  const cellWidth = useMemo(() => width / daysCount, [width, daysCount]);\n\n  // mouse position and date\n  const [pos, setPos] = useState<Pos>({ x: 0, y: 0 });\n  const date = useMemo(\n    () => posToDate(pos, width, normalizedStartDay, cellHeight),\n    [pos, width, normalizedStartDay, cellHeight]\n  );\n\n  // shadow event\n  const [startDragDate, setStartDragDate] = useState<Date>();\n\n  const shadowEvent = useMemo<HwcEvent | undefined>(() => {\n    if (!startDragDate) return undefined;\n\n    const dates = [\n      roundToQuarterHour(startDragDate),\n      roundToQuarterHour(date),\n    ].sort((a, b) => a.getTime() - b.getTime());\n\n    return {\n      startDate: dates[0],\n      endDate: dates[1],\n    };\n  }, [startDragDate, date]);\n\n  const requestAddEventHandler = useCallback(\n    (ev: HwcEvent) => {\n      onAddEventRequest(ev);\n    },\n    [onAddEventRequest]\n  );\n\n  return {\n    pos,\n    date,\n    cellWidth,\n    cellHeight,\n\n    startDay: normalizedStartDay,\n    daysCount,\n\n    events,\n\n    setPos,\n    setWidth,\n\n    shadowEvent,\n    setStartDragDate,\n    requestAddEventHandler,\n  };\n};\n","import React, { useCallback, useRef, useState } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport { HOUR_IN_MILLIS } from '../constants';\nimport { useHwcContext } from '../contexts/HwcContext';\nimport { Pos } from '../models/pos.model';\nimport { roundToQuarterHour } from '../utils/round';\nimport ResizeObserver from 'resize-observer-polyfill';\n\nexport type HwcDragPaneProps = React.ComponentProps<'div'> & {};\n\nexport const HwcDragPane = React.forwardRef<HTMLDivElement, HwcDragPaneProps>(\n  (\n    {\n      onMouseMove = () => {},\n      onMouseDown = () => {},\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const {\n      setPos,\n      date,\n      setWidth,\n      setStartDragDate,\n      requestAddEventHandler,\n      shadowEvent,\n      cellHeight,\n    } = useHwcContext();\n\n    const [element, setRef] = useState<HTMLDivElement | null>(null);\n\n    useIsomorphicLayoutEffect(() => {\n      if (!element) return;\n\n      const observer = new ResizeObserver(([entry]) => {\n        if (entry) setWidth(entry.contentRect.width);\n      });\n      observer.observe(element);\n\n      return () => {\n        observer.disconnect();\n      };\n    }, [element, setWidth]);\n\n    // shadow event\n    const mouseDownDate = useRef<Date>();\n\n    const mouseDownHandler = useCallback<\n      React.MouseEventHandler<HTMLDivElement>\n    >(\n      ev => {\n        if (\n          !(ev.target instanceof Element) ||\n          !ev.target.hasAttribute('week-picker-cell')\n        )\n          return;\n        // prevent dnd\n        ev.preventDefault();\n\n        mouseDownDate.current = date;\n\n        onMouseDown(ev);\n      },\n      [date, onMouseDown]\n    );\n\n    const mouseMoveHandler = useCallback<\n      React.MouseEventHandler<HTMLDivElement>\n    >(\n      ev => {\n        const offset = ev.currentTarget.getBoundingClientRect();\n        const pos: Pos = {\n          x: ev.clientX - offset.left,\n          y: ev.clientY - offset.top,\n        };\n\n        setPos(pos);\n\n        onMouseMove(ev);\n\n        if (\n          mouseDownDate.current &&\n          !shadowEvent &&\n          roundToQuarterHour(mouseDownDate.current).getTime() !==\n            roundToQuarterHour(date).getTime()\n        ) {\n          setStartDragDate(mouseDownDate.current);\n        }\n      },\n      [setPos, onMouseMove, shadowEvent, date, setStartDragDate]\n    );\n\n    useIsomorphicLayoutEffect(() => {\n      const dragEndHandler = () => {\n        if (mouseDownDate.current) {\n          if (shadowEvent) {\n            requestAddEventHandler(shadowEvent);\n          } else {\n            requestAddEventHandler({\n              startDate: date,\n              endDate: new Date(date.getTime() + 2 * HOUR_IN_MILLIS),\n            });\n          }\n        }\n\n        mouseDownDate.current = undefined;\n        setStartDragDate(undefined);\n      };\n\n      window.addEventListener('mouseup', dragEndHandler);\n\n      return () => {\n        window.removeEventListener('mouseup', dragEndHandler);\n      };\n    }, [setStartDragDate, requestAddEventHandler, shadowEvent, date]);\n\n    return (\n      <div\n        {...props}\n        style={{\n          position: 'relative',\n          height: `${cellHeight * 24}px`,\n          ...style,\n        }}\n        onMouseMove={mouseMoveHandler}\n        onDrag={ev => ev.preventDefault()}\n        onMouseDown={mouseDownHandler}\n        ref={ref || setRef}\n      >\n        {children}\n      </div>\n    );\n  }\n);\n","import React, { Fragment } from 'react';\nimport { DAY_IN_MILLIS } from '../constants';\nimport { useHwcContext } from '../contexts/HwcContext';\n\nexport type RenderCellProps = {\n  style: React.CSSProperties;\n  cellHeight: number;\n  cellWidth: number;\n  x?: 'start' | 'end';\n  y?: 'start' | 'end';\n  date: Date;\n};\n\nexport type HwcGridProps = Omit<React.ComponentProps<'div'>, 'children'> & {\n  colStyle?: React.CSSProperties;\n  defaultStyles?: boolean;\n\n  children?: (props: RenderCellProps) => JSX.Element | JSX.Element[];\n};\n\nconst defaultCellRenderer = ({ style }: RenderCellProps) => (\n  <div style={style} />\n);\n\nexport const HwcGrid = React.forwardRef<HTMLDivElement, HwcGridProps>(\n  ({ style, colStyle, children, ...props }, ref) => {\n    const { startDay, cellHeight, cellWidth, daysCount } = useHwcContext();\n\n    const days = new Array(daysCount)\n      .fill(0)\n      .map((_, index) => new Date(startDay.getTime() + index * DAY_IN_MILLIS));\n    const lines = new Array(24).fill(0).map((_, index) => index);\n\n    return (\n      <div\n        {...props}\n        ref={ref}\n        style={{\n          position: 'absolute',\n          width: '100%',\n          display: 'flex',\n          ...style,\n        }}\n      >\n        {days.map((d, dIndex) => (\n          <div\n            key={dIndex}\n            style={{ flex: '0 0 1', width: '100%', ...colStyle }}\n          >\n            {lines.map(l => {\n              const x =\n                dIndex === 0\n                  ? 'start'\n                  : dIndex === days.length - 1\n                  ? 'end'\n                  : undefined;\n              const y =\n                l === 0 ? 'start' : l === lines.length - 1 ? 'end' : undefined;\n\n              return (\n                <Fragment key={l}>\n                  {React.Children.map(\n                    (children || defaultCellRenderer)({\n                      cellHeight,\n                      cellWidth,\n                      style: {\n                        height: `${cellHeight}px`,\n                        borderLeft:\n                          x === 'start' ? undefined : `#aaa solid 1px`,\n                        borderTop: y === 'start' ? undefined : `#aaa solid 1px`,\n                        boxSizing: 'border-box',\n                      },\n                      x,\n                      y,\n                      date: d,\n                    }),\n                    node => React.cloneElement(node, { 'week-picker-cell': '' })\n                  )}\n                </Fragment>\n              );\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n);\n","import { DAY_IN_MILLIS } from '../constants';\nimport { HwcEvent } from '../models/event.model';\nimport { startOfDay } from './round';\n\nexport const buildIsEventVisibleFilter = (\n  startDay: Date,\n  daysCount: number\n) => {\n  const startMillis = startOfDay(startDay).getTime();\n  const endMillis = startMillis + daysCount * DAY_IN_MILLIS;\n\n  return (ev: HwcEvent) => {\n    return (\n      ev.startDate.getTime() < endMillis && ev.endDate.getTime() > startMillis\n    );\n  };\n};\n\nexport const getCroppedEventsByDay = (ev: HwcEvent): HwcEvent[] => {\n  const events: HwcEvent[] = [];\n\n  const evEndMillis = ev.endDate.getTime();\n\n  for (let i = 0; i < 20; i++) {\n    const lastCroppedEvent: HwcEvent | undefined = events[events.length - 1];\n    const nextDayMillis = lastCroppedEvent\n      ? startOfDay(lastCroppedEvent.startDate).getTime() + 2 * DAY_IN_MILLIS\n      : startOfDay(ev.startDate).getTime() + 1 * DAY_IN_MILLIS;\n\n    const isOverflow = nextDayMillis < evEndMillis;\n\n    events.push({\n      startDate: new Date(\n        lastCroppedEvent ? lastCroppedEvent.endDate : ev.startDate\n      ),\n      endDate: new Date(isOverflow ? nextDayMillis : evEndMillis),\n    });\n\n    if (!isOverflow) break;\n  }\n\n  return events;\n};\n","import React, { Fragment, useMemo } from 'react';\nimport { DAY_IN_MILLIS, HOUR_IN_MILLIS } from '../constants';\nimport { useHwcContext } from '../contexts/HwcContext';\nimport { HwcEvent } from '../models/event.model';\nimport {\n  buildIsEventVisibleFilter,\n  getCroppedEventsByDay,\n} from '../utils/events';\nimport { startOfDay } from '../utils/round';\n\nexport type Rect = {\n  width: number;\n  height: number;\n  left: number;\n  top: number;\n};\n\nexport type RenderCardProps = {\n  event: HwcEvent;\n  rect: Rect;\n  isFirst: boolean;\n  isLast: boolean;\n};\n\nexport type HwcEventsRendererProps = {\n  renderCard?: (props: RenderCardProps) => React.ReactNode;\n};\n\nconst defaultRenderCard = ({ rect }: RenderCardProps) => {\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        backgroundColor: 'orange',\n        border: 'solid orangered 2px',\n        boxSizing: 'border-box',\n        borderRadius: '3px',\n        width: `${rect.width - 2}px`,\n        height: `${rect.height - 2}px`,\n        left: `${rect.left}px`,\n        top: `${rect.top}px`,\n      }}\n    />\n  );\n};\n\nexport const HwcEventsRenderer: React.FC<HwcEventsRendererProps> = ({\n  renderCard,\n}) => {\n  const { events, cellWidth, cellHeight, startDay, daysCount, shadowEvent } =\n    useHwcContext();\n\n  const cards = useMemo<RenderCardProps[]>(() => {\n    const eventsFilter = buildIsEventVisibleFilter(startDay, daysCount);\n\n    return [...events, ...(shadowEvent ? [shadowEvent] : [])]\n      .filter(eventsFilter)\n      .map(getCroppedEventsByDay)\n      .map(croppeds =>\n        croppeds.map((ev, index) => ({\n          ...ev,\n          isFirst: index === 0,\n          isLast: index === croppeds.length - 1,\n        }))\n      )\n      .flat()\n      .filter(eventsFilter)\n      .map(ev => {\n        const day =\n          (startOfDay(ev.startDate).getTime() -\n            startOfDay(startDay).getTime()) /\n          DAY_IN_MILLIS;\n\n        const duration = ev.endDate.getTime() - ev.startDate.getTime();\n        const millisFromDayStart =\n          ev.startDate.getTime() - startOfDay(ev.startDate).getTime();\n\n        return {\n          event: {\n            startDate: ev.startDate,\n            endDate: ev.endDate,\n          },\n          rect: {\n            width: cellWidth,\n            height: (duration / HOUR_IN_MILLIS) * cellHeight,\n            left: day * cellWidth,\n            top: (millisFromDayStart / HOUR_IN_MILLIS) * cellHeight,\n          },\n          isFirst: ev.isFirst,\n          isLast: ev.isLast,\n        };\n      });\n  }, [events, cellWidth, startDay, daysCount, shadowEvent, cellHeight]);\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {cards.map((cardProps, index) => {\n        return (\n          <Fragment key={index}>\n            {(renderCard || defaultRenderCard)(cardProps)}\n          </Fragment>\n        );\n      })}\n    </div>\n  );\n};\n","import React from 'react';\nimport { DAY_IN_MILLIS } from '../constants';\nimport { useHwcContext } from '../contexts/HwcContext';\n\nexport type HwcHeaderProps = {\n  locale?: string;\n  dateFormatOptions?: Intl.DateTimeFormatOptions;\n};\n\nexport const HwcHeader: React.FC<HwcHeaderProps> = ({\n  locale,\n  dateFormatOptions = { day: '2-digit', weekday: 'short' },\n}) => {\n  const { startDay, daysCount } = useHwcContext();\n\n  const days = new Array(daysCount)\n    .fill(0)\n    .map((_, index) => new Date(startDay.getTime() + index * DAY_IN_MILLIS));\n\n  return (\n    <div style={{ display: 'flex' }}>\n      {days.map((d, dIndex) => (\n        <div key={dIndex} style={{ flex: '0 0 1', width: '100%' }}>\n          {d.toLocaleDateString(locale, dateFormatOptions)}\n        </div>\n      ))}\n    </div>\n  );\n};\n"],"names":["HwcContext","React","createContext","HwcProvider","Provider","useHwcContext","ctx","useContext","Error","MINUTE_IN_MILLIS","HOUR_IN_MILLIS","DAY_IN_MILLIS","posToDate","pos","width","startDay","hourHeight","minuteHeight","minutesDay","y","dayInGrid","Math","trunc","x","Date","getTime","roundToQuarterHour","date","rounded","startOfMinute","minutes","getMinutes","getHours","roundedMinute","round","d","startOfDay","setMinutes","input","setHours","setSeconds","useHwc","props","cellHeight","daysCount","events","onAddEventRequest","normalizedStartDay","useMemo","useState","setWidth","cellWidth","setPos","startDragDate","setStartDragDate","shadowEvent","undefined","dates","sort","a","b","startDate","endDate","requestAddEventHandler","useCallback","ev","HwcDragPane","forwardRef","ref","onMouseMove","onMouseDown","style","children","element","setRef","useIsomorphicLayoutEffect","observer","ResizeObserver","entry","contentRect","observe","disconnect","mouseDownDate","useRef","mouseDownHandler","target","Element","hasAttribute","preventDefault","current","mouseMoveHandler","offset","currentTarget","getBoundingClientRect","clientX","left","clientY","top","dragEndHandler","window","addEventListener","removeEventListener","position","height","onDrag","defaultCellRenderer","HwcGrid","colStyle","days","Array","fill","map","_","index","lines","display","dIndex","key","flex","l","length","Fragment","Children","borderLeft","borderTop","boxSizing","node","cloneElement","buildIsEventVisibleFilter","startMillis","endMillis","getCroppedEventsByDay","evEndMillis","i","lastCroppedEvent","nextDayMillis","isOverflow","push","defaultRenderCard","rect","backgroundColor","border","borderRadius","HwcEventsRenderer","renderCard","cards","eventsFilter","filter","croppeds","isFirst","isLast","flat","day","duration","millisFromDayStart","event","cardProps","HwcHeader","locale","dateFormatOptions","weekday","toLocaleDateString"],"mappings":"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"}